define(["wdn","ready","dropdown-widget","require"],function(e,t,n,i){"use strict";var r=function(e){return document.querySelector("link[rel="+e+"]")},d=function(){var t=r("login"),n=r("logout");return t&&e.setPluginParam("idm","login",t.getAttribute("href")),n&&e.setPluginParam("idm","logout",n.getAttribute("href")),e.getPluginParam("idm")||{}},o=encodeURIComponent(window.location),u="https://shib.unl.edu/idp/profile/cas/logout?url="+o,c="https://shib.unl.edu/idp/profile/cas/login?service="+o,a=!1,s=function(e){return!(!a||!a[e])&&a[e][0]},l={initialize:function(n){var r=function(){t(function(){var e=d();e.login&&l.setLoginURL(e.login),l.renderAsLoggedOut()}),n&&n()},o=e.getCookie("unl_sso");o?i(["https://whoami.unl.edu/?id="+o],function(){e.idm.user&&(l.setUser(e.idm.user),delete e.idm.user),l.getUserId()?(n&&n(),t(function(){l.renderAsLoggedIn()})):(l.logout(),r())}):r()},setUser:function(e){a=e},logout:function(){e.setCookie("unl_sso","0",-1),a=!1},isLoggedIn:function(){return!!l.getUserId()},getUserId:function(){return a&&a.uid},getDisplayName:function(){var e="";return a.eduPersonNickname?e=a.eduPersonNickname[0]:a.givenName?e=a.givenName[0]:a.displayName&&(e=a.displayName[0]),e},getFirstName:function(){return s("givenName")},getLastName:function(){return s("sn")},getPrimaryAffiliation:function(){return s("eduPersonPrimaryAffiliation")},getEmailAddress:function(){return s("mail")},getPostalAddress:function(){return s("postalAddress")},getTelephoneNumber:function(){return s("telephoneNumber")},getTitle:function(){return s("title")},getProfileURL:function(){if(!this.isLoggedIn())return!1;var e=this.getUserId(),t="unl_";return"s-"===e.substring(2,0)?t+=e.replace("-","_"):t+=e,"https://planetred.unl.edu/pg/profile/"+t},renderAsLoggedIn:function(){for(var e=this,t=document.querySelectorAll(".dcf-idm"),i=d(),r=0;r<t.length;r++)!function(r){var d=document.createElement("BUTTON");d.classList.add("dcf-idm-login","dcf-d-flex","dcf-ai-center","dcf-jc-center","dcf-relative","dcf-h-100%","dcf-w-100%","dcf-p-0","dcf-b-0","dcf-bg-transparent","unl-font-sans","unl-scarlet"),d.setAttribute("id","dcf-idm-toggle"),d.setAttribute("aria-haspopup","true"),d.setAttribute("aria-expanded","false"),d.setAttribute("aria-controls","dcf-idm-options-"+r),d.setAttribute("aria-label","Account actions for "+e.getDisplayName());var o=document.createElement("IMG");o.classList.add("dcf-idm-img","dcf-txt-sm","dcf-h-6","dcf-w-6","dcf-circle","unl-bg-cream"),o.setAttribute("src","https://directory.unl.edu/avatar/"+e.getUserId()),o.setAttribute("alt",""),d.appendChild(o);var c=document.createElement("SPAN");c.classList.add("dcf-idm-label","dcf-txt-2xs","dcf-truncate"),c.innerText=e.getDisplayName(),d.appendChild(c);var a=document.createElement("DIV");a.classList.add("dcf-idm-options","dcf-absolute","dcf-pt-6","dcf-pr-5","dcf-pb-5","dcf-pl-5","dcf-z-1","dcf-bg-overlay-dark"),a.setAttribute("id","dcf-idm-options-"+r),a.hidden=!0;var s=document.createElement("UL");s.classList.add("dcf-list-bare","dcf-mb-0","dcf-txt-2xs","unl-font-sans");var f=document.createElement("LI"),g=document.createElement("A");g.classList.add("unl-cream"),g.setAttribute("href",e.getProfileURL()),g.innerText="View Profile",f.appendChild(g),s.appendChild(f);var m=document.createElement("LI"),p=document.createElement("A");p.classList.add("unl-cream"),p.setAttribute("href",u),p.innerText="Logout",m.appendChild(p),s.appendChild(m),a.appendChild(s);var h=t[r].querySelector(".dcf-idm-status-logged-out"),v=t[r].querySelector(".dcf-idm-status-logged-in");v.innerHTML="",v.appendChild(d),v.appendChild(a);var L=(new n(v,"idm-logged-in"),new CustomEvent("closeNavigation")),b=new CustomEvent("closeSearch");document.addEventListener("openDropDownWidget",function(e){"idm-logged-in"==e.detail.type&&(document.dispatchEvent(L),document.dispatchEvent(b))}),h.hidden=!0,v.hidden=!1,p.removeEventListener("click",l.logout),p.addEventListener("click",l.logout),l.setLogoutURL(i.logout),p.setAttribute("href",u)}(r)},renderAsLoggedOut:function(){if(!l.getUserId())for(var e=document.querySelectorAll(".dcf-idm"),t=0;t<e.length;t++){var n=e[t].querySelector(".dcf-idm-status-logged-out"),i=e[t].querySelector(".dcf-idm-status-logged-in"),r=n.querySelector("a");r.setAttribute("href",c),i.hidden=!0,n.hidden=!1}},setLogoutURL:function(e){e&&(u=e)},setLoginURL:function(e){e&&(c=e)}};return e.idm={},l});
//# sourceMappingURL=idm.js.map